# Руководство по разработке Shield AI

Автоматически сгенерировано из всех планов функций. Последнее обновление: 2025-11-15

## Активные технологии

- Python 3.12
- pandas
- openpyxl
- Loguru (библиотека для логирования)
- pytest (тестирование)
- MyPy (строгая типизация)
- Проверка типов (pyright)
- Excel-файлы (входные данные)
- JSON, Markdown, SQLite (выходные форматы)
- dataclasses и TypedDict (структурирование данных)
- Streamlit (UI интерфейс)
- CLI (интерфейс командной строки)
- WSL 2 (окружение разработки)

## Структура проекта

```text
shield_ai_v2/
├── src/
│   └── shield_ai/
│       ├── domain/                 # Область предметной области
│       ├── application/            # Слой приложения (use cases)
│       ├── infrastructure/         # Инфраструктурный слой
│       │   ├── parsers/            # Парсеры данных (Excel и др.)
│       │   └── exporters/          # Экспортеры (JSON, Markdown, SQLite)
│       └── presentation/           # Слой представления (CLI, UI)
├── tests/
│   ├── unit/                      # Модульные тесты
│   └── integration/               # Интеграционные тесты
├── specs/                         # Спецификации функций
│   ├── 002-external-batch-processing/
│   ├── 003-flat-structure-analysis/
│   ├── 004-hierarchical-to-flat/
│   └── 03-flat-structure/
├── pages/                         # Streamlit страницы
├── docs/                          # Документация
├── data/                          # Данные для тестирования
└── requirements.txt               # Зависимости проекта
```

## Команды

- `make install` - Установка зависимостей
- `make run` - Запуск Streamlit UI
- `make init-db` - Инициализация БД
- `make test` - Запуск тестов (pytest)
- `make test-cov` - Запуск тестов с отчетом о покрытии
- `make lint` - Линтинг (ruff)
- `make pylint` - Проверка стиля кода (pylint)
- `make format` - Форматирование (black+isort)
- `make typecheck` - Проверка типов (pyright)
- `make pyright` - Проверка типов (pyright)
- `make pre-commit` - Запуск pre-commit хуков
- `make bandit` - Сканирование безопасности
- `make safety` - Проверка уязвимостей в зависимостях
- `make dependency-check` - Проверка актуальности зависимостей
- `make docs-build` - Генерация документации (Sphinx)
- `make ci` - Полный CI пайплайн
- `make complexity-check` - Анализ сложности кода (radon)
- `make security` - Проверка безопасности (bandit + pip-audit)
- `make coverage` - Отчет покрытия тестами (проверка >= 80%)
- `make complexity` - Метрики сложности кода (radon)
- `make all` - Полная проверка перед коммитом (все команды + pre-commit hooks)
- `make migrate` - Выполнить миграции БД
- `make migrate-create` - Создать новую миграцию
- `make test-unit` - Запуск модульных тестов
- `make test-integration` - Запуск интеграционных тестов
- `make test-validation` - Запуск валидационных тестов
- `make pip-audit` - Аудит безопасности пакетов

## Стиль кода

- Синхронный код без использования `async/await`, `asyncio`, корутин
- Строгая типизация с использованием MyPy в режиме strict
- Использование `dataclasses` и `TypedDict` для структурирования данных
- Чистая архитектура с разделением на слои: domain, application, infrastructure, presentation
- Логирование с использованием библиотеки Loguru
- Обработка ошибок с предоставлением информативных сообщений
- Покрытие кода юнит-тестами не менее 80% для всего кода и 95% для слоёв domain и application
- Соблюдение принципов SOLID и DRY
- Использование pandas для операций с данными

## Недавние изменения

- Реализация обработки "внешних" партий в классе `InventoryParser` с созданием специальных партий при отсутствии соответствующих данных
- Рефакторинг проекта для реализации функциональности расчёта усушки и учёта по партиям с акцентом на упрощённый импорт данных
- Разработка парсера, преобразующего иерархические Excel-отчеты "Ведомость по партиям номенклатуры" в плоскую структуру данных
- Создание CLI-интерфейса для пакетной обработки Excel-файлов и генерации отчетов об ошибках
- Внедрение строгой типизации и юнит-тестов для обеспечения качества кода и корректной работы системы

<!-- MANUAL ADDITIONS START -->

<!-- MANUAL ADDITIONS END -->
