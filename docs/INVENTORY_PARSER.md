# üìö Shield AI v2.0 - InventoryParser

## 1. –í–≤–µ–¥–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å `InventoryParser` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ Excel-–æ—Ç—á—ë—Ç–æ–≤ –æ –¥–≤–∏–∂–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Å–∏—Å—Ç–µ–º—ã 1–° –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —É–¥–æ–±–Ω—ã–µ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –≤ —Ä–∞–±–æ—Ç–µ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –≤—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø–∞—Ä—Å–µ—Ä–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –ø—É—Ç–∏: [`src/shield_ai/infrastructure/parsers/inventory_parser.py`](src/shield_ai/infrastructure/parsers/inventory_parser.py)

## 2. –û–±–∑–æ—Ä –∫–ª–∞—Å—Å–∞ `InventoryParser`

### 2.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ö–ª–∞—Å—Å `InventoryParser` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É —á—Ç–µ–Ω–∏—è Excel-—Ñ–∞–π–ª–æ–≤, –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–∑ –Ω–∏—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–≤–∏–∂–µ–Ω–∏—è—Ö –∏ –æ—Å—Ç–∞—Ç–∫–∞—Ö —Ç–æ–≤–∞—Ä–æ–≤, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±—ä–µ–∫—Ç—ã –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—è (`BatchMovement`, `BatchBalance`).

### 2.2. –ú–µ—Ç–æ–¥—ã

#### `__init__(self, logger: Optional[Logger] = None)`
*   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞.
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    *   `logger` (Optional[Logger]): –≠–∫–∑–µ–º–ø–ª—è—Ä –ª–æ–≥–≥–µ—Ä–∞. –ï—Å–ª–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–æ–≥–≥–µ—Ä.

#### `_validate_column_types(self, df: pd.DataFrame, col_name: str, expected_types: List[type] | type, col_display_name: str) -> None`
*   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ DataFrame.
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    *   `df` (pd.DataFrame): DataFrame –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
    *   `col_name` (str): –ò–º—è –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
    *   `expected_types` (List[type] | type): –û–∂–∏–¥–∞–µ–º—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (–∏–ª–∏ —Å–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤).
    *   `col_display_name` (str): –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
*   **–ò—Å–∫–ª—é—á–µ–Ω–∏—è**: `ValidationException` –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

#### `parse_file(self, file_path: str) -> pd.DataFrame`
*   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Excel-—Ñ–∞–π–ª –≤ –ø–ª–æ—Å–∫–∏–π DataFrame.
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    *   `file_path` (str): –ü—É—Ç—å –∫ Excel-—Ñ–∞–π–ª—É.
*   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `pd.DataFrame` - –ø–ª–æ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Excel-—Ñ–∞–π–ª–∞.
*   **–ò—Å–∫–ª—é—á–µ–Ω–∏—è**: `Exception` –ø—Ä–∏ –æ—à–∏–±–∫–µ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞.

#### `parse_excel(self, file_path: str) -> Tuple[List[BatchMovement], List[BatchBalance]]`
*   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Excel-—Ñ–∞–π–ª –≤ —Å–ø–∏—Å–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ `BatchMovement` –∏ `BatchBalance`.
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    *   `file_path` (str): –ü—É—Ç—å –∫ Excel-—Ñ–∞–π–ª—É.
*   **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `tuple[list[BatchMovement], list[BatchBalance]]` - –ö–æ—Ä—Ç–µ–∂ –∏–∑ –¥–≤—É—Ö —Å–ø–∏—Å–∫–æ–≤: —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ `BatchMovement` –∏ —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ `BatchBalance`.
*   **–ò—Å–∫–ª—é—á–µ–Ω–∏—è**: `ValidationException`, `ParserException`, `Exception` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞.

#### `save_to_json(self, data: pd.DataFrame, output_file: str) -> None`
*   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ (DataFrame) –≤ JSON-—Ñ–∞–π–ª.
*   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
    *   `data` (pd.DataFrame): –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ `parse_file()`.
    *   `output_file` (str): –ü—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É JSON-—Ñ–∞–π–ª—É.

## 3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

`InventoryParser` —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel-—Ñ–∞–π–ª–∞–º–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ –¥–∞–Ω–Ω—ã–µ –æ –¥–≤–∏–∂–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞", "nomenclature", "product").

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏**:
*   `–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞` (–∏–ª–∏ `nomenclature`, `product`)
*   `–î–∞—Ç–∞` (–∏–ª–∏ `date`, `dt`)
*   `–¢–∏–ø–î–≤–∏–∂–µ–Ω–∏—è` (–∏–ª–∏ `movement_type`, `type`)
*   `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ` (–∏–ª–∏ `quantity`, `qty`, `amount`)
*   `–°–∫–ª–∞–¥` (–∏–ª–∏ `warehouse`, `wh`)

**–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏**:
*   `–ü–∞—Ä—Ç–∏—è` (–∏–ª–∏ `batch`, `party`) - –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞.

## 4. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from src.shield_ai.infrastructure.parsers.inventory_parser import InventoryParser

# –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ø–∞—Ä—Å–µ—Ä–∞
parser = InventoryParser()

# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É Excel
excel_file_path = "data/input/inventory.xlsx"

try:
    # –ü–∞—Ä—Å–∏–Ω–≥ Excel-—Ñ–∞–π–ª–∞
    movements, balances = parser.parse_excel(excel_file_path)

    print(f"–£—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ {len(movements)} –¥–≤–∏–∂–µ–Ω–∏–π –∏ {len(balances)} –æ—Å—Ç–∞—Ç–∫–æ–≤.")

    # –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –ø–µ—Ä–≤—ã—Ö –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏–π
    print("\n–ü–µ—Ä–≤—ã–µ 5 –¥–≤–∏–∂–µ–Ω–∏–π:")
    for move in movements[:5]:
        print(f"  {move.nomenclature} - {move.date} - {move.quantity} - {move.movement_type}")

    # –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –ø–µ—Ä–≤—ã—Ö –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤
    print("\n–ü–µ—Ä–≤—ã–µ 5 –æ—Å—Ç–∞—Ç–∫–æ–≤:")
    for bal in balances[:5]:
        print(f"  {bal.nomenclature} - {bal.date} - {bal.balance} - {bal.batch}")

except Exception as e:
    print(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ: {e}")