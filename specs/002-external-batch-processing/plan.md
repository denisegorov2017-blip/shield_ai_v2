# План реализации: Обработка внешних партий

**Ветка**: `002-external-batch-processing` | **Дата**: 2025-11-13 | **Спецификация**: [specs/002-external-batch-processing/spec.md](specs/002-external-batch-processing/spec.md)
**Ввод**: Спецификация функции из `/specs/002-external-batch-processing/spec.md`

## Резюме

Реализовать обработку "внешних" партий в классе `InventoryParser`. Метод `_apply_fifo_expense` должен в случае отсутствия соответствующих партий для списания создавать "внешнюю" партию. В итоговом отчёте необходимо добавить уведомление о таких партиях, выделять их в Markdown/JSON отчёте и логировать создание.

## Технический контекст

**Язык/Версия**: Python 3.11
**Основные зависимости**: pandas, re, json, logging, openpyxl
**Хранилище**: Н/Д (работа с файлами Excel и JSON)
**Тестирование**: pytest
**Целевая платформа**: сервер Linux
**Тип проекта**: одиночный (модификация существующего модуля)
**Цели производительности**: Отсутствуют специфические цели, важно сохранение текущей производительности парсера.
**Ограничения**: Отсутствуют специфические ограничения.
**Масштаб/Объем**: Модификация одного существующего метода и добавление вспомогательных функций.

## Проверка конституции

ПРОХОД: Должен пройти до исследования фазы 0. Повторная проверка после проектирования фазы 1.

## Структура проекта

### Документация (эта функция)

```text
specs/002-external-batch-processing/
├── plan.md              # Этот файл (вывод команды /speckit.plan)
├── research.md          # Вывод фазы 0 (команда /speckit.plan) - Н/Д
├── data-model.md        # Вывод фазы 1 (команда /speckit.plan) - Н/Д
├── quickstart.md        # Вывод фазы 1 (команда /speckit.plan) - Н/Д
├── contracts/           # Вывод фазы 1 (команда /speckit.plan) - Н/Д
└── tasks.md             # Вывод фазы 2 (команда /speckit.tasks - НЕ создается командой /speckit.plan) - Н/Д
```

### Исходный код (корень репозитория)

```text
src/
├── shield_ai/
│   └── infrastructure/
│       └── parsers/
│           └── inventory_parser.py # Модификация этого файла
```

**Решение по структуре**: Модификация существующего файла `src/shield_ai/infrastructure/parsers/inventory_parser.py`.

## Отслеживание сложности

> **Заполнить ТОЛЬКО если проверка конституции имеет нарушения, которые должны быть оправданы**

| Нарушение | Почему необходимо | Более простая альтернатива отклонена, потому что |
|-----------|------------|-------------------------------------|
| Н/Д | Н/Д | Н/Д |