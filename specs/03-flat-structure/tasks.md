# Задачи: Рефакторинг проекта для расчёта усушки и учёта по партиям

**Функциональная ветка**: `03-flat-structure`\
**Создано**: 2025-11-14

## Обзор задач

Данный документ описывает конкретные задачи для реализации плана рефакторинга проекта shield_ai_v2.

## Задачи по этапам

### Этап 3: Реализация доменного слоя

- [ ] **Задача 3.1**: Создать dataclass для BatchMovement с полями: номенклатура, дата, тип_движения, количество, склад
- [ ] **Задача 3.2**: Создать dataclass для BatchBalance с полями: номенклатура, дата, остаток, склад, партия
- [ ] **Задача 3.3**: Создать dataclass для ShrinkageCalculation с полями: номенклатура, рассчитанная_усушка, фактический_остаток, отклонение
- [ ] **Задача 3.4**: Реализовать логику расчёта усушки в доменном слое
- [ ] **Задача 3.5**: Написать юнит-тесты для доменных сущностей

### Этап 4: Реализация инфраструктурного слоя

- [ ] **Задача 4.1**: Создать упрощённый парсер Excel с flat-преобразованием
- [ ] **Задача 4.2**: Реализовать функции импорта из JSON и Markdown
- [ ] **Задача 4.3**: Реализовать функции экспорта в JSON, Markdown и SQLite
- [ ] **Задача 4.4**: Написать юнит-тесты для инфраструктурных компонентов

### Этап 5: Реализация прикладного слоя

- [ ] **Задача 5.1**: Создать use case для калькуляции усушки
- [ ] **Задача 5.2**: Создать use case для аудита остатков
- [ ] **Задача 5.3**: Создать use case для генерации отчетов
- [ ] **Задача 5.4**: Реализовать функцию аудита минусовых остатков
- [ ] **Задача 5.5**: Реализовать функцию отчёта по излишкам
- [ ] **Задача 5.6**: Написать юнит-тесты для прикладных компонентов

### Этап 6: Реализация слоя представления

- [ ] **Задача 6.1**: Обновить Streamlit UI для импорта данных
- [ ] **Задача 6.2**: Обновить Streamlit UI для расчёта усушки
- [ ] **Задача 6.3**: Обновить Streamlit UI для аудита и отчётов
- [ ] **Задача 6.4**: Создать CLI интерфейс для основных операций
- [ ] **Задача 6.5**: Протестировать пользовательские сценарии

### Этап 7: Интеграционное тестирование и улучшения

- [ ] **Задача 7.1**: Провести интеграционное тестирование всех слоёв
- [ ] **Задача 7.2**: Оптимизировать производительность основных операций
- [ ] **Задача 7.3**: Исправить выявленные проблемы

### Этап 8: Документация и подготовка к развёртыванию

- [ ] **Задача 8.1**: Обновить README с описанием flat-подхода
- [ ] **Задача 8.2**: Обновить QUICK_START.md с инструкциями по запуску
- [ ] **Задача 8.3**: Обновить ARCHITECTURE.md с новой схемой слоёв
- [ ] **Задача 8.4**: Создать примеры Markdown-отчетов
- [ ] **Задача 8.5**: Подготовить документацию для будущих интеграций